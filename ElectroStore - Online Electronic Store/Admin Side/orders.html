<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders - ElectroStore Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.tailwindcss.com/2.2.19" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="dashboard.html" class="sidebar-logo">
                    <i class="fas fa-bolt"></i> ElectroStore Admin
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="dashboard.html" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    
                    <div class="nav-section">Products</div>
                    <li class="nav-item">
                        <a href="products.html" class="nav-link">
                            <i class="fas fa-box"></i>
                            <span>All Products</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="add-product.html" class="nav-link">
                            <i class="fas fa-plus"></i>
                            <span>Add Product</span>
                        </a>
                    </li>
                    
                    <div class="nav-section">Orders</div>
                    <li class="nav-item">
                        <a href="orders.html" class="nav-link active">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Orders</span>
                        </a>
                    </li>
                    
                    <div class="nav-section">Users</div>
                    <li class="nav-item">
                        <a href="users.html" class="nav-link">
                            <i class="fas fa-users"></i>
                            <span>Customers</span>
                        </a>
                    </li>
                    
                    <div class="nav-section">Settings</div>
                    <li class="nav-item">
                        <a href="settings.html" class="nav-link">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main" id="mainContent">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="breadcrumb">
                        <a href="dashboard.html">Dashboard</a> / Orders
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="admin-user" onclick="AdminPanel.logoutAdmin()">
                        <div class="user-avatar">A</div>
                        <span class="admin-user-name">Admin</span>
                        <i class="fas fa-sign-out-alt ms-2"></i>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="admin-content">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="page-title">Orders Management</h1>
                        <p class="page-subtitle">Track and manage customer orders</p>
                    </div>
                    <div>
                        <button class="btn btn-outline me-2" onclick="exportOrders()">
                            <i class="fas fa-download me-2"></i>Export Orders
                        </button>
                        <button class="btn btn-primary" onclick="refreshOrders()">
                            <i class="fas fa-sync me-2"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- Order Stats -->
                <div class="row mb-4">
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="order-stat-card bg-primary">
                            <div class="stat-info">
                                <h3 id="total-orders-count">0</h3>
                                <p>Total Orders</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="order-stat-card bg-success">
                            <div class="stat-info">
                                <h3 id="pending-orders-count">0</h3>
                                <p>Pending Orders</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="order-stat-card bg-warning">
                            <div class="stat-info">
                                <h3 id="processing-orders-count">0</h3>
                                <p>Processing</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="order-stat-card bg-info">
                            <div class="stat-info">
                                <h3 id="completed-orders-count">0</h3>
                                <p>Completed</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row align-items-end">
                            <div class="col-md-3">
                                <label class="form-label">Order Status</label>
                                <select class="form-select" id="statusFilter" onchange="filterOrders()">
                                    <option value="">All Orders</option>
                                    <option value="pending">Pending</option>
                                    <option value="processing">Processing</option>
                                    <option value="shipped">Shipped</option>
                                    <option value="delivered">Delivered</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Date Range</label>
                                <input type="date" class="form-control" id="dateFrom" onchange="filterOrders()">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <input type="date" class="form-control" id="dateTo" onchange="filterOrders()">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-outline w-100" onclick="clearFilters()">
                                    <i class="fas fa-times me-2"></i>Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Orders</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- No Orders Message -->
                <div id="noOrdersMessage" class="text-center py-5" style="display: none;">
                    <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                    <h5>No Orders Found</h5>
                    <p class="text-muted">Orders will appear here when customers make purchases.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Order Details Modal -->
    <div class="modal fade" id="orderDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Order Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="orderDetailsContent">
                    <!-- Order details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="printOrder()">
                        <i class="fas fa-print me-2"></i>Print Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Status Modal -->
    <div class="modal fade" id="updateStatusModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Order Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="updateStatusForm">
                        <input type="hidden" id="updateOrderId">
                        <div class="mb-3">
                            <label class="form-label">New Status</label>
                            <select class="form-select" id="newStatus" required>
                                <option value="pending">Pending</option>
                                <option value="processing">Processing</option>
                                <option value="shipped">Shipped</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="statusNotes" rows="3" placeholder="Add any notes about this status update..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveStatusUpdate()">Update Status</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        // Orders Page Specific JavaScript
        
        // Global variables for orders
        let allOrders = [];
        let filteredOrders = [];
        let currentOrderId = null;

        // Initialize orders page
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
            setDateDefaults();
        });

        function setDateDefaults() {
            const today = new Date();
            const oneMonthAgo = new Date(today);
            oneMonthAgo.setMonth(today.getMonth() - 1);

            document.getElementById('dateFrom').value = oneMonthAgo.toISOString().split('T')[0];
            document.getElementById('dateTo').value = today.toISOString().split('T')[0];
        }

        function loadOrders() {
            // Load orders from localStorage
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            allOrders = orders;
            filteredOrders = [...orders];
            
            updateOrderStats();
            displayOrders();
        }

        function updateOrderStats() {
            const stats = {
                total: allOrders.length,
                pending: allOrders.filter(o => o.status === 'pending').length,
                processing: allOrders.filter(o => o.status === 'processing').length,
                completed: allOrders.filter(o => o.status === 'delivered').length
            };

            document.getElementById('total-orders-count').textContent = stats.total;
            document.getElementById('pending-orders-count').textContent = stats.pending;
            document.getElementById('processing-orders-count').textContent = stats.processing;
            document.getElementById('completed-orders-count').textContent = stats.completed;
        }

        function displayOrders() {
            const tbody = document.getElementById('ordersTableBody');
            const noOrdersMessage = document.getElementById('noOrdersMessage');

            if (filteredOrders.length === 0) {
                tbody.innerHTML = '';
                noOrdersMessage.style.display = 'block';
                return;
            }

            noOrdersMessage.style.display = 'none';
            tbody.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td><strong>#${order.id}</strong></td>
                    <td>
                        <div>
                            <div class="fw-medium">${order.customerName}</div>
                            <small class="text-muted">${order.customerEmail}</small>
                        </div>
                    </td>
                    <td>
                        <div>${new Date(order.date).toLocaleDateString()}</div>
                        <small class="text-muted">${new Date(order.date).toLocaleTimeString()}</small>
                    </td>
                    <td>${order.items.length} item(s)</td>
                    <td><strong>₹${order.total.toLocaleString()}</strong></td>
                    <td><span class="badge bg-${getStatusColor(order.status)}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewOrderDetails('${order.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-success" onclick="updateOrderStatus('${order.id}')" title="Update Status">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            const colors = {
                pending: 'warning',
                processing: 'info',
                shipped: 'primary',
                delivered: 'success',
                cancelled: 'danger'
            };
            return colors[status] || 'secondary';
        }

        function filterOrders() {
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;

            filteredOrders = allOrders.filter(order => {
                const matchesStatus = !statusFilter || order.status === statusFilter;
                const orderDate = new Date(order.date).toISOString().split('T')[0];
                const matchesDate = (!dateFrom || orderDate >= dateFrom) && (!dateTo || orderDate <= dateTo);
                
                return matchesStatus && matchesDate;
            });

            displayOrders();
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            filteredOrders = [...allOrders];
            displayOrders();
        }

        function viewOrderDetails(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;

            const modalContent = document.getElementById('orderDetailsContent');
            modalContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>Order Information</h6>
                        <table class="table table-sm">
                            <tr><td>Order ID:</td><td><strong>#${order.id}</strong></td></tr>
                            <tr><td>Date:</td><td>${new Date(order.date).toLocaleDateString()}</td></tr>
                            <tr><td>Status:</td><td><span class="badge bg-${getStatusColor(order.status)}">${order.status}</span></td></tr>
                            <tr><td>Payment:</td><td>${order.paymentMethod}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Customer Information</h6>
                        <table class="table table-sm">
                            <tr><td>Name:</td><td>${order.customerName}</td></tr>
                            <tr><td>Email:</td><td>${order.customerEmail}</td></tr>
                            <tr><td>Phone:</td><td>${order.customerPhone}</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6>Shipping Address</h6>
                    <p>${order.shippingAddress.street}<br>
                    ${order.shippingAddress.city}, ${order.shippingAddress.state} ${order.shippingAddress.pincode}</p>
                </div>

                <div class="mt-4">
                    <h6>Order Items</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead><tr><th>Product</th><th>Quantity</th><th>Price</th><th>Total</th></tr></thead>
                            <tbody>
                                ${order.items.map(item => `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td>${item.quantity}</td>
                                        <td>₹${item.price.toLocaleString()}</td>
                                        <td>₹${(item.quantity * item.price).toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mt-3 text-end">
                    <h5>Total: ₹${order.total.toLocaleString()}</h5>
                </div>
            `;

            new bootstrap.Modal(document.getElementById('orderDetailsModal')).show();
        }

        function updateOrderStatus(orderId) {
            currentOrderId = orderId;
            const order = allOrders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('updateOrderId').value = orderId;
                document.getElementById('newStatus').value = order.status;
                document.getElementById('statusNotes').value = '';
                new bootstrap.Modal(document.getElementById('updateStatusModal')).show();
            }
        }

        function saveStatusUpdate() {
            const orderId = document.getElementById('updateOrderId').value;
            const newStatus = document.getElementById('newStatus').value;
            const notes = document.getElementById('statusNotes').value;

            // Update order status
            const orderIndex = allOrders.findIndex(o => o.id === orderId);
            if (orderIndex !== -1) {
                allOrders[orderIndex].status = newStatus;
                if (notes) {
                    allOrders[orderIndex].statusNotes = notes;
                }

                // Save to localStorage
                localStorage.setItem('orders', JSON.stringify(allOrders));

                // Refresh display
                filterOrders();
                updateOrderStats();

                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('updateStatusModal')).hide();

                // Show success message
                showNotification('Order status updated successfully!', 'success');
            }
        }

        function refreshOrders() {
            loadOrders();
            showNotification('Orders refreshed!', 'info');
        }

        function exportOrders() {
            const dataStr = JSON.stringify(filteredOrders, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `orders-export-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function printOrder() {
            window.print();
        }

        function showNotification(message, type) {
            // Simple notification system
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close ms-2" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>